# 協力型パーティーWebゲーム『テーマ・スケール』仕様書

## 1. 概要

本プロジェクトは、1～100の数字カードを直接言わずに、ラウンドごとに設定されるテーマ（お題）に沿った「たとえ」で表現し、他のプレイヤーと協力してカードを数字の小さい順に並べるマルチプレイ型ブラウザゲームです。

*   **ゲーム名（提案）:** テーマ・スケール (Theme Scale)
*   **ジャンル:** 協力型パーティーゲーム (リアルタイム同期必須)
*   **プレイ人数:** 2人～8人（観戦者は無制限、またはサーバー負荷を考慮し上限を設定）

## 2. システム・技術要件

### 2.1. インフラストラクチャ

*   **デプロイ環境:** Dockerコンテナとして構築し、VPS（Virtual Private Server）上で実行可能とすること。
*   **構成:** フロントエンド、バックエンド（ゲームロジック・同期）の構成とする。
    
    *   **永続化:** データベースによる永続化保存は行わない。すべてのゲーム状態はサーバーのオンメモリ上で管理する。

### 2.2. 技術スタック (提案)

*   **フロントエンド:** HTML, Tailwind CSS, JavaScript (ES6+)
*   **バックエンド:** Node.js / Python (リアルタイム通信およびオンメモリ状態管理)
*   **リアルタイム通信:** WebSocket (Socket.IO など) を使用し、ゲーム状態、カード操作、チャット、スケール変更を全参加者間でミリ秒単位で同期すること。

### 2.3. オンメモリデータ構造 (参考)

サーバーメモリ上で管理する状態オブジェクトの例。

|  |
|  |

| フィールド        | 型      | 説明                                                                                  |
| ------------ | ------ | ----------------------------------------------------------------------------------- |
| roomId       | String | URL発行時のユニークID                                                                       |
| hostId       | String | ルームを作成したプレイヤーの userId                                                               |
| status       | String | 'LOBBY', 'PLAYING', 'PAUSED', 'RESULT', 'ENDED'                                     |
| gameSettings | Map    | 初期手札枚数, ライフ数, 勝利条件, 制限時間など                                                          |
| players      | Map    | 参加者情報 (userId, name, color, currentHand, isReady, connectionStatus, joinedAt, role) |
| currentRound | Int    | 現在のラウンド数                                                                            |
| deck         | Array  | 現在のラウンドで使用する1~100から選出されたユニークなカードリスト                                                 |
| currentTheme | Map    | { name, scale1, scale100, freeInput, editingUser }                                  |
| voteTimer    | Int    | 投票フェーズの残り時間                                                                         |

*   **`role` 定義:**
    
    *   `'PLAYER'`: ゲームに参加し、手札を持つプレイヤー。
    *   `'SPECTATOR'`: ゲーム進行には関与しない観戦者。

## 3. ゲームフローとルール詳細

### 3.1. ゲームの準備（ロビーフェーズ）

1.  **ルーム作成:** ホストはゲーム設定を行い、専用の参加URLを生成する。
2.  **参加:** URLにアクセスしたプレイヤーは、任意の名前を入力し、自動的にユニークなカラーが割り当てられて入室する。
    
    *   **再接続用ID:** ブラウザのLocalStorage等に一時的なIDを保存し、リロードや再接続時に同じプレイヤーとして復帰できるようにする。
    *   **途中参加（観戦モード）:**
        
        *   ゲームステータスが `LOBBY` の場合、新規入室者は `PLAYER` として参加する。
        *   ゲームステータスが `PLAYING` (プレイ中) の場合、新規入室者は自動的に `SPECTATOR` (観戦者) として参加する。
3.  **設定調整:** ホストはゲーム開始前であれば、設定を自由に変更できる。
4.  **ゲーム開始:** 全員が準備完了（Ready）を押した後、ホストがゲームを開始する。

### 3.2. ゲーム設定（カスタマイズ可能項目）

| 設定項目         | デフォルト値（提案） | 調整範囲     |
| ------------ | ---------- | -------- |
| 初期手札枚数       | 1枚         | 1枚～（任意）  |
| 勝利条件         | 3回成功       | 1回～（任意）  |
| ライフ数         | 2          | 1～（任意）   |
| 制限時間（表現フェーズ） | 60秒        | 10秒刻みで調整 |
| 制限時間（提出フェーズ） | 60秒        | 10秒刻みで調整 |

### 3.3. ラウンドの流れ

1.  **カード配布:**
    
    *   **毎ラウンド開始時に山札（1～100）をリセットし**、1～100の数字から**重複しないように**ランダムに選出し、現在の手札枚数分各 `PLAYER` に配られる。
    *   **観戦者 (`SPECTATOR`) にはカードは配られない。**
2.  **テーマ決定:** プリセットリストからランダム選択、またはフリー入力で決定。テーマ名と初期スケール（1と100の例）を画面に表示。
3.  **表現フェーズ (時間制限あり):**
    
    *   全 `PLAYER` および `SPECTATOR` がテキストチャットを通じて会話可能。
    *   `PLAYER` は自分の数字をテーマに沿った「たとえ」で表現する。
    *   **ルール（数字発言の制限）:** 自分の数字を直接言うことは禁止。
        
        *   **紳士協定:** システム的なNGワードフィルターは実装しない。
        *   **観戦者のマナー:** 観戦者もチャットに参加できるが、プレイヤーの数字を推測して発言したり、正解を示唆するような発言は禁止とする（紳士協定）。
    *   **スケール変更機能:** 全 `PLAYER` はスケールテキストを書き換えることができる（観戦者は閲覧のみ）。
4.  **提出フェーズ (時間制限あり):**
    
    *   `PLAYER` は手札を提出エリアへドラッグ＆ドロップ（DnD）で提出する。
    *   **再配置:** `PLAYER` は「提出完了」ボタンを押すまでは、提出エリア内で何度でもカードを並べ替えることができる。
    *   `SPECTATOR` は提出エリアの操作はできない（リアルタイムでカードが動く様子は同期される）。
    *   全 `PLAYER` が提出を終え「提出完了」ボタンを押した時点でフェーズ終了。

### 3.4. 判定とリザルト

1.  **判定:** 全 `PLAYER` の提出完了後、**サーバーサイド**で正誤判定を行う。
2.  **リザルト表示:**
    
    *   全員のカードをオープンし、正誤を表示。
    *   失敗時はドボン箇所をハイライト。
3.  **手札とライフの処理:**
    
    *   **成功時:** ライフ維持。次ラウンド手札 `+1`。
    *   **失敗時:** ライフ `-1`。リザルト画面で**全 `PLAYER` による多数決**を行う（観戦者は投票権なし）。
        
        *   **選択肢:** 「手札をそのまま継続」 or 「手札を1枚減らして再挑戦」。
        *   **投票タイマー:** **30秒**の制限時間を設ける。時間切れの場合、未投票者は「手札をそのまま継続」に投票したものとみなす。
        *   **同数（ドロー）:** 「手札をそのまま継続」を採用。
4.  **ゲーム終了条件:**
    
    *   ライフ `0` でゲームオーバー、条件達成で完全勝利。
    *   **終了後のフロー:** リザルト画面に「ロビーに戻る」ボタンを表示し、ホストが押下することでゲーム状態をリセットし、ロビー画面へ遷移する。
    *   **観戦者の扱い:**
        
        *   ロビーに戻っても、`SPECTATOR` は**自動的に `PLAYER` へ昇格しない**（観戦者属性を維持する）。
        *   観戦者がプレイヤーとして参加したい場合は、別のルームを作成するか、再入室し直す必要がある（本ゲームはルームごとの役割固定運用を前提とする）。

### 3.5. エンドレスモードとエクストラクリア

*   **エクストラクリア条件（やり込み要素）:**
    
    *   手札が増えていき、**「次ラウンドの配布総数（1人あたりの枚数 × 現在の `PLAYER` 人数）」が100枚を超える計算となった時点**で、次のラウンドは行わずエクストラクリアとする。
    *   ※観戦者の人数は計算に含まない。

### 3.6. 通信切断・復帰・権限委譲

*   **一時停止:** プレイ中に `PLAYER` の通信が切断された場合、ゲームは即座に**一時停止状態**となる（観戦者の切断はゲーム進行に影響しない）。
    
    *   一時停止中もチャットは利用可能。
*   **復帰:** 同じURLにアクセスしIDが一致すれば復帰可能。
*   **強制続行（キック機能）:**
    
    *   `PLAYER` のオフライン状態が**1分**を超えた場合、ホストにキックボタンを表示。
    *   キックされた `PLAYER` のカードは除外され、残りの `PLAYER` で判定を行う。
*   **最低人数割れによる終了:**
    
    *   プレイ進行中に切断やキックにより参加 `PLAYER` が **1名以下** になった場合、協力ゲームとしての要件を満たさないため、即座に **ゲームオーバー**（ライフ0扱い）とし、リザルト画面へ移行する。
*   **ホスト権限の委譲:**
    
    *   ホストが退出した場合、残っている `PLAYER` の中で**最も早く入室していた（joinedAtが古い）者**に自動的にホスト権限を委譲する。
    *   `PLAYER` が全滅し `SPECTATOR` のみになった場合、ルームは自動的に閉鎖（またはロビーへリセット）される。

## 4. UI/UX要件

### 4.1. 画面構成

*   **中央:** ゲームボード（テーマ表示、提出エリア）。
*   **左側:** リアルタイムチャットログエリア。
*   **下部:** 操作エリア。
    
    *   **PLAYER:** 手札カード、たとえ入力、提出完了ボタン、スケール編集機能。
    *   **SPECTATOR:** 「現在観戦中です」等のステータス表示のみ（操作系UIは非表示）。

### 4.2. カード提出と同期 (最重要)

*   **視認性:** `PLAYER` カラーによる色分け。
*   **DnDと再配置:** `PLAYER` は提出完了前なら何度でも再配置可能。`SPECTATOR` は操作不可だが動きは同期される。
*   **スマホ対応:** タッチ操作対応、スクロール制御。

### 4.3. スケール編集機能（排他制御）

*   **操作:** `PLAYER` がクリックで編集モード（ロック）。他者は編集不可。
*   **ロック解除:** 入力完了、オフライン化、または**30秒無操作**で自動解除。

### 4.4. その他UX対策

*   **ブラウザバック対策:** `beforeunload` アラートの実装。

## 5. プリセットテーマ 100選と初期スケール

（変更なし。以下、プリセットリストが続く）

| ID   | カテゴリ   | テーマ         | スケール 1（最小）初期例 | スケール 100（最大）初期例 |
| ---- | ------ | ----------- | ------------- | --------------- |
| 1.   | 生物・自然  | 大きい動物       | アリ            | シロナガスクジラ        |
| 2.   | 生物・自然  | 硬い物質        | 豆腐            | ダイヤモンド          |
| 3.   | 生物・自然  | 美しい花        | タンポポ          | バラ              |
| 4.   | 生物・自然  | 暗い場所        | 玄関            | 深海              |
| 5.   | 生物・自然  | 速い動物        | ナマケモノ         | チーター            |
| 6.   | 生物・自然  | 甘い食べ物       | お米            | 砂糖              |
| 7.   | 生物・自然  | 酸っぱいもの      | 水             | レモン果汁           |
| 8.   | 生物・自然  | 危険な生き物      | ハエ            | ホホジロザメ          |
| 9.   | 生物・自然  | 重い乗り物       | 自転車           | 戦車              |
| 10.  | 生物・自然  | 寒い場所        | 冷蔵庫の中         | 北極点             |
| 11.  | 時間・速さ  | 遅い乗り物       | 人間の歩行         | ロケット            |
| 12.  | 時間・速さ  | 短い時間        | 1秒            | 1年              |
| 13.  | 時間・速さ  | 発生頻度が高いこと   | 呼吸            | 皆既日食            |
| 14.  | 時間・速さ  | 経験したことがないこと | 普段の食事         | 宇宙旅行            |
| 15.  | 時間・速さ  | 長い待ち時間      | ラーメン屋での待ち時間   | 30年ぶりの再会        |
| 16.  | 時間・速さ  | 速い通信速度      | 手紙            | 光通信             |
| 17.  | 時間・速さ  | 遠い距離        | 1メートル         | 地球から月までの距離      |
| 18.  | 時間・速さ  | 古い技術        | 石器            | 人工知能            |
| 19.  | 時間・速さ  | 難しいゲーム      | 三目並べ          | 囲碁              |
| 20.  | 時間・速さ  | 幼い年齢        | 1歳            | 100歳            |
| 21.  | 温度・感覚  | 寒いもの        | 常温の水          | 液体窒素            |
| 22.  | 温度・感覚  | 熱いもの        | 体温            | 太陽の表面           |
| 23.  | 温度・感覚  | 柔らかいもの      | 布             | 粘土              |
| 24.  | 温度・感覚  | 騒がしい場所      | 図書館           | ライブ会場           |
| 25.  | 温度・感覚  | 辛い食べ物       | ご飯            | 唐辛子（ジョロキア）      |
| 26.  | 温度・感覚  | 明るいもの       | 月明かり          | 太陽              |
| 27.  | 温度・感覚  | 臭いもの        | 石鹸            | シュールストレミング      |
| 28.  | 温度・感覚  | 振動が小さいもの    | 静止した物体        | 地震              |
| 29.  | 温度・感覚  | 薄い色         | 無色透明          | 黒               |
| 30.  | 温度・感覚  | 重いもの        | 羽根            | 戦艦              |
| 31.  | 感情・抽象度 | ポジティブな感情    | 安堵            | 至福              |
| 32.  | 感情・抽象度 | ネガティブな感情    | 不満            | 絶望              |
| 33.  | 感情・抽象度 | 必要なもの       | 趣味            | 水と食料            |
| 34.  | 感情・抽象度 | 抽象的なもの      | 現実            | 概念              |
| 35.  | 感情・抽象度 | 危険な職業       | 事務員           | 消防士             |
| 36.  | 感情・抽象度 | 有名なスポーツ     | クリケット         | サッカー            |
| 37.  | 感情・抽象度 | 感謝の気持ち      | 軽いお礼          | 命の恩人への感謝        |
| 38.  | 感情・抽象度 | 嘘の度合い       | 軽い冗談          | 詐欺              |
| 39.  | 感情・抽象度 | 難しい勉強       | 算数            | 量子力学            |
| 40.  | 感情・抽象度 | 達成感         | 部屋の掃除         | 夢の実現            |
| 41.  | 価値・価格  | 安価なもの       | 1円玉           | 億万長者の豪邸         |
| 42.  | 価値・価格  | 珍しいもの       | 小石            | 隕石              |
| 43.  | 価値・価格  | 便利な道具       | 箸             | スマートフォン         |
| 44.  | 価値・価格  | 普遍的なもの      | 空気            | 特定の国の法律         |
| 45.  | 価値・価格  | 環境に良いこと     | ペットボトルの再利用    | 再生可能エネルギーの普及    |
| 46.  | 価値・価格  | 不必要なもの      | 予備の電池         | 砂漠の砂            |
| 47.  | 価値・価格  | 現代の発明       | 火の使用          | インターネット         |
| 48.  | 価値・価格  | 希少な資源       | 水道水           | 金               |
| 49.  | 価値・価格  | 広い場所        | 部屋            | 宇宙              |
| 50.  | 価値・価格  | 科学的な事実      | 血液型占い         | 重力理論            |
| 51.  | 身体・健康  | 運動能力        | 散歩            | マラソンランナー        |
| 52.  | 身体・健康  | 健康的な食べ物     | ハンバーガー        | 野菜              |
| 53.  | 身体・健康  | 痛み          | 軽い擦り傷         | 骨折              |
| 54.  | 身体・健康  | 疲労度         | 軽い眠気          | 過労死寸前           |
| 55.  | 身体・健康  | 薬の効き目       | プラセボ          | 劇薬              |
| 56.  | 身体・健康  | 睡眠時間        | 1時間           | 12時間            |
| 57.  | 身体・健康  | 身長の高さ       | 100cm         | 200cm           |
| 58.  | 身体・健康  | 視力          | 0.1           | 2.0             |
| 59.  | 身体・健康  | 髪の長さ        | 丸刈り           | 膝まである髪          |
| 60.  | 身体・健康  | 集中力         | 気が散っている状態     | 瞑想              |
| 61.  | 芸術・文化  | 有名な絵画       | 近所の子供の絵       | モナリザ            |
| 62.  | 芸術・文化  | 感情的な音楽      | 環境音           | 交響曲             |
| 63.  | 芸術・文化  | 長編小説        | 短編詩           | 大河小説            |
| 64.  | 芸術・文化  | ポップカルチャー    | 古代の儀式         | TikTok          |
| 65.  | 芸術・文化  | ユーモアの度合い    | 真顔            | 爆笑              |
| 66.  | 芸術・文化  | 派手なファッション   | Tシャツとジーンズ     | 全身ブランド品         |
| 67.  | 芸術・文化  | 映画の興行収入     | 学生の自主制作       | アバター            |
| 68.  | 芸術・文化  | 歌唱力         | 音痴            | プロの歌手           |
| 69.  | 芸術・文化  | 影響力のある芸術家   | 無名の画家         | ピカソ             |
| 70.  | 芸術・文化  | 想像力         | 現実の描写         | 抽象芸術            |
| 71.  | 社会・政治  | 人口密度        | 砂漠            | 東京の満員電車         |
| 72.  | 社会・政治  | 平和な国        | 戦争中の国         | スイス             |
| 73.  | 社会・政治  | 厳格な法律       | 交通ルール         | 死刑制度            |
| 74.  | 社会・政治  | 重要なニュース     | 天気予報          | 世界大戦の勃発         |
| 75.  | 社会・政治  | 政治への関心      | 全くない          | 政治家             |
| 76.  | 社会・政治  | 社会的貢献度      | 何もしていない       | ノーベル平和賞受賞者      |
| 77.  | 社会・政治  | 危険な物質       | 水             | プルトニウム          |
| 78.  | 社会・政治  | 議論の余地がある問題  | 好きな食べ物        | 哲学の根源           |
| 79.  | 社会・政治  | 自由度が高い国     | 北朝鮮           | 好きな国            |
| 80.  | 社会・政治  | 影響力のある技術    | 鉛筆            | 原子力             |
| 81.  | 技術・科学  | 古い発明        | 車輪            | ロボット工学          |
| 82.  | 技術・科学  | 複雑な機械       | 缶切り           | 宇宙ステーション        |
| 83.  | 技術・科学  | 高いエネルギー     | 懐中電灯の電池       | 核融合炉            |
| 84.  | 技術・科学  | 小さい部品       | 釘             | ナノ粒子            |
| 85.  | 技術・科学  | 脆い物質        | 蜘蛛の糸          | ガラス             |
| 86.  | 技術・科学  | 透明度         | 曇りガラス         | 真空              |
| 87.  | 技術・科学  | 音の大きさ       | ささやき声         | ジェット機のエンジン      |
| 88.  | 技術・科学  | 温度変化の速さ     | 鉄             | 水               |
| 89.  | 技術・科学  | 精密な計測       | 体重計           | 高精度原子時計         |
| 90.  | 技術・科学  | 科学の進歩速度     | 中世            | 現代              |
| 91.  | 日常・その他 | 食べやすさ       | 岩             | スープ             |
| 92.  | 日常・その他 | 楽しかったこと     | 退屈な日          | 最高の旅行           |
| 93.  | 日常・その他 | 役立つスキル      | 料理            | 外科手術            |
| 94.  | 日常・その他 | 危険な趣味       | 編み物           | バンジージャンプ        |
| 95.  | 日常・その他 | 掃除の頻度       | 1年に1回         | 毎日3回            |
| 96.  | 日常・その他 | 服装のフォーマル度   | パジャマ          | タキシード           |
| 97.  | 日常・その他 | 必要な知識       | 自分の名前         | 宇宙の法則           |
| 98.  | 日常・その他 | 覚えやすい名前     | A             | ラマヌジャン          |
| 99.  | 日常・その他 | 信頼できる情報源    | 噂話            | 専門家の論文          |
| 100. | 日常・その他 | 驚きの度合い      | 予定通り          | 宝くじ当選           |